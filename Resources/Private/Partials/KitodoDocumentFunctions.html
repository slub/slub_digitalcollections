<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
    xmlns:dc="http://typo3.org/ns/Slub/SlubDigitalcollections/ViewHelpers" data-namespace-typo3-fluid="true" lang="en">

<div class="document-functions">
    <div class="provider">
        <f:comment><!-- [provider logo] ----------------------------- --></f:comment>
        <f:if condition="{settings.showProviderLogo}">
            <ul>
                <f:alias map="{logoUrl: '{dc:xpath(xpath:\'(//mets:amdSec/mets:rightsMD/mets:mdWrap[@OTHERMDTYPE=\"DVRIGHTS\"]/mets:xmlData/dv:rights/dv:ownerLogo)[1]\')}', logoTitle: '{dc:xpath(xpath:\'(//mets:amdSec/mets:rightsMD/mets:mdWrap[@OTHERMDTYPE=\"DVRIGHTS\"]/mets:xmlData/dv:rights/dv:owner)[1]\')}',
                    logoUri: '{dc:xpath(xpath:\'
                    (//mets:amdSec/mets:rightsMD/mets:mdWrap[@OTHERMDTYPE=\"DVRIGHTS\"]/mets:xmlData/dv:rights/dv:ownerSiteURL)[1]\',
                    htmlspecialchars:\'FALSE\')}'}">
                    <f:if condition="{dc:providerLogoCached(logo:'{logoUrl}')}">
                        <li>
                            <f:link.external uri="{logoUri}" title="{logoTitle}">
                                <img src="/typo3temp/assets/images/{dc:providerLogoCached(logo:'{logoUrl}')}"
                                    width="108" title="{logoTitle}" alt="Logo von {logoTitle}" />
                            </f:link.external>
                        </li>
                    </f:if>
                </f:alias>
                <f:alias map="{logoUrl: '{dc:xpath(xpath:\'(//mets:amdSec/mets:rightsMD/mets:mdWrap[@OTHERMDTYPE=\"DVRIGHTS\"]/mets:xmlData/dv:rights/dv:aggregatorLogo)[1]\')}', logoTitle: '{dc:xpath(xpath:\'(//mets:amdSec/mets:rightsMD/mets:mdWrap[@OTHERMDTYPE=\"DVRIGHTS\"]/mets:xmlData/dv:rights/dv:aggregator)[1]\')}',
                    logoUri: '{dc:xpath(xpath:\'
                    (//mets:amdSec/mets:rightsMD/mets:mdWrap[@OTHERMDTYPE=\"DVRIGHTS\"]/mets:xmlData/dv:rights/dv:aggregatorSiteURL)[1]\',
                    htmlspecialchars:\'FALSE\')}'}">
                    <f:if condition="{dc:providerLogoCached(logo:'{logoUrl}')}">
                        <li>
                            <f:link.external uri="{logoUri}" title="{logoTitle}">
                                <img src="/typo3temp/assets/images/{dc:providerLogoCached(logo:'{logoUrl}')}"
                                    width="108" title="{logoTitle}" alt="Logo von {logoTitle}" />
                            </f:link.external>
                        </li>
                    </f:if>
                </f:alias>
                <f:alias map="{logoUrl: '{dc:xpath(xpath:\'(//mets:amdSec/mets:rightsMD/mets:mdWrap[@OTHERMDTYPE=\"DVRIGHTS\"]/mets:xmlData/dv:rights/dv:sponsorLogo)[1]\')}', logoTitle: '{dc:xpath(xpath:\'(//mets:amdSec/mets:rightsMD/mets:mdWrap[@OTHERMDTYPE=\"DVRIGHTS\"]/mets:xmlData/dv:rights/dv:sponsor)[1]\')}',
                    logoUri: '{dc:xpath(xpath:\'
                    (//mets:amdSec/mets:rightsMD/mets:mdWrap[@OTHERMDTYPE=\"DVRIGHTS\"]/mets:xmlData/dv:rights/dv:sponsorSiteURL)[1]\',
                    htmlspecialchars:\'FALSE\')}'}">
                    <f:if condition="{dc:providerLogoCached(logo:'{logoUrl}')}">
                        <li>
                            <f:link.external uri="{logoUri}" title="{logoTitle}">
                                <img src="/typo3temp/assets/images/{dc:providerLogoCached(logo:'{logoUrl}')}"
                                    width="108" title="{logoTitle}" alt="Logo von {logoTitle}" />
                            </f:link.external>
                        </li>
                    </f:if>
                </f:alias>
            </ul>
        </f:if>
        <dl class="mobile-meta">
            <dt class="tx-dlf-title">Titel</dt>
            <dd class="tx-dlf-title">
                <a href="#">{docTitle}</a>
            </dd>
            <dt>Autor</dt>
            <dd>
                <dc:xpath
                    xpath='(//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:relatedItem[@type="host"]/mods:name[//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:name/mods:role/mods:roleTerm[@authority="marcrelator"][@type="code"]="aut"]/mods:displayForm)[1]' />
            </dd>
        </dl>
    </div>
    <f:comment><!-- [link navigation] ----------------------------- --></f:comment>
    <ul>
        <li class="submenu links">
            <a href="#" title="Links">Links</a>
            <ul>
                <f:comment><!-- [Permalink] ----------------------------------------- --></f:comment>
                <f:if condition="<dc:xpath xpath='(//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:identifier[@type=\"purl\"])[1]' />">
                    <li class="permalink">
                        <f:link.external uri="<dc:xpath xpath='(//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:identifier[@type=\" purl\"])[1]' />"
                        class="persistence-document"
                        target="_blank"
                        title="<f:translate key='purl.document' extensionName='slub_digitalcollections' />">
                            <span class="perma-label"><f:translate key='purl.document' extensionName='slub_digitalcollections' /></span>
                            <dc:xpath xpath='(//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:identifier[@type="purl"])[1]' />
                        </f:link.external>
                    </li>
                    <li class="permalink">
                        <f:link.external uri="<dc:xpath xpath='(//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:identifier[@type=\"purl\"])[1]' />/{gp-page}"
                        class="persistence-page"
                        target="_blank"
                        title="<f:translate key='purl.singlePage' extensionName='slub_digitalcollections' />">
                            <span class="perma-label"><f:translate key='purl.singlePage' extensionName='slub_digitalcollections' /></span>
                            <dc:xpath xpath='(//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:identifier[@type="purl"])[1]' />/{gp-page}
                        </f:link.external>
                    </li>
                </f:if>

                <f:comment><!-- [reference links ] ----------------------------- --></f:comment>
                <f:for each="{0: '1', 1: '2', 2: '3'}" as="index">
                    <f:if condition="<dc:xpath xpath='(//mets:amdSec/mets:digiprovMD/mets:mdWrap[@OTHERMDTYPE=\"DVLINKS\"]/mets:xmlData/dv:links/dv:reference)[{index}]' />">
                    <li>
                        <f:if condition="<dc:xpath xpath='(//mets:amdSec/mets:digiprovMD/mets:mdWrap[@OTHERMDTYPE=\"DVLINKS\"]/mets:xmlData/dv:links/dv:reference/@linktext)[{index}]' />">
                        <f:then>
                            <f:link.external uri="<dc:xpath xpath='(//mets:amdSec/mets:digiprovMD/mets:mdWrap[@OTHERMDTYPE=\"DVLINKS\"]/mets:xmlData/dv:links/dv:reference)[{index}]' />"
                            class="local-catalog"
                            target="_blank"
                            title="<f:translate key='provider.local_catalogue' extensionName='slub_digitalcollections' />"><dc:xpath xpath='(//mets:amdSec/mets:digiprovMD/mets:mdWrap[@OTHERMDTYPE="DVLINKS"]/mets:xmlData/dv:links/dv:reference/@linktext)[{index}]' /></f:link.external>
                        </f:then>
                        <f:else>
                            <f:link.external uri="<dc:xpath xpath='(//mets:amdSec/mets:digiprovMD/mets:mdWrap[@OTHERMDTYPE=\"DVLINKS\"]/mets:xmlData/dv:links/dv:reference)[{index}]' />"
                            class="local-catalog"
                            target="_blank"
                            title="<f:translate key='provider.local_catalogue' extensionName='slub_digitalcollections' />"><f:translate key='provider.local_catalogue' extensionName='slub_digitalcollections' /></f:link.external>
                        </f:else>
                        </f:if>
                    </li>
                    </f:if>
                </f:for>

                <f:comment><!-- [License informations] ------------------------------ --></f:comment>
                <f:if condition="{settings.termsOfUsePid}">
                    <li class="license">
                        <f:link.page pageUid="{settings.termsOfUsePid}" class="terms-of-use" target="_blank"
                            title="{dc:pageInfo(uid:'{settings.termsOfUsePid}', field:'title')}">
                            {dc:pageInfo(uid:'{settings.termsOfUsePid}', field:'title')}
                        </f:link.page>
                    </li>
                </f:if>
            </ul>
        </li>

        <f:comment><!-- [downloads] ----------------------------- --></f:comment>
        <li class="submenu downloads">
            <a href="#" title="Downloads">Downloads</a>
            <ul>
                <li class="pdf-download has-multilinks">
                    <f:cObject typoscriptObjectPath="plugin.tx_dlf_pdfdownloadtool" />
                </li>
        </li>

        <f:comment><!-- [Image downloads (JPG)] ----------------------------- --></f:comment>
        <!-- ORDER: ORIGINAL (best) -> MAX -> DEFAULT -->
        <f:if condition="{dc:xpath(xpath:'(/mets:mets/mets:fileSec/mets:fileGrp[@USE=\"ORIGINAL\"]/mets:file/mets:FLocat/@xlink:href)[{gp-page}]')}">
            <f:then>
                <f:variable name="usedFileGrp" value="[@USE=\" ORIGINAL\"]" />
            </f:then>
            <f:else if="{dc:xpath(xpath:'(/mets:mets/mets:fileSec/mets:fileGrp[@USE=\"MAX\"]/mets:file/mets:FLocat/@xlink:href)[{gp-page}]')}">
                <f:variable name="usedFileGrp" value="[@USE=\" MAX\"]" />
            </f:else>
            <f:else if="{dc:xpath(xpath:'(/mets:mets/mets:fileSec/mets:fileGrp[@USE=\"DEFAULT\"]/mets:file/mets:FLocat/@xlink:href)[{gp-page}]')}">
                <f:variable name="usedFileGrp" value="[@USE=\" DEFAULT\"]" />
            </f:else>
        </f:if>

        <f:variable name="mimeType"
            value="{dc:xpath(xpath:'(/mets:mets/mets:fileSec/mets:fileGrp/mets:file/@MIMETYPE)[{gp-page}]')}" />
        <f:if condition="{gp-double} == 1">
            <f:then>
                <li class="jpg-download has-multilinks">
                    <div class="multilinks">
                        <f:link.external
                            uri="<dc:xpath xpath='(//mets:fileSec/mets:fileGrp{usedFileGrp}//mets:file/mets:FLocat/@xlink:href)[{gp-page}]' />{f:if(condition:\"
                            {mimeType}=='application/vnd.kitodo.iiif' \", then:'/full/full/0/default.jpg')}"
                            class="download-document image left" target="_blank"
                            title="<f:translate key='download.image.leftPage' extensionName='slub_digitalcollections' />">
                            <f:translate key="download.image.leftPage" extensionName="slub_digitalcollections" />
                        </f:link.external>
                        <f:link.external
                            uri="<dc:xpath xpath='(//mets:fileSec/mets:fileGrp{usedFileGrp}//mets:file/mets:FLocat/@xlink:href)[{gp-page2}]' />{f:if(condition:\"
                            {mimeType}=='application/vnd.kitodo.iiif' \", then:'/full/full/0/default.jpg')}"
                            class="download-document image right" target="_blank"
                            title="<f:translate key='download.image.rightPage' extensionName='slub_digitalcollections' />">
                            <f:translate key="download.image.rightPage" extensionName="slub_digitalcollections" />
                        </f:link.external>
                    </div>
                </li>
            </f:then>
            <f:else>
                <li class="jpg-download">
                    <f:link.external
                        uri="<dc:xpath xpath='(//mets:fileSec/mets:fileGrp{usedFileGrp}//mets:file/mets:FLocat/@xlink:href)[{gp-page}]' />{f:if(condition:\"
                        {mimeType}=='application/vnd.kitodo.iiif' \", then:'/full/full/0/default.jpg')}"
                        class="download-document image" target="_blank"
                        title="<f:translate key='download.image.singlePage' extensionName='slub_digitalcollections' />">
                        <f:translate key="download.image.singlePage" extensionName="slub_digitalcollections" />
                    </f:link.external>
                </li>
            </f:else>
        </f:if>

        <f:comment><!-- [Fulltext downloads (XML)] -------------------------- --></f:comment>
        <f:if condition="<dc:xpath xpath='(//mets:fileSec/mets:fileGrp[@USE=\"FULLTEXT\"]/mets:file[1]/mets:FLocat/@xlink:href)[1]' />">
        <f:if condition="{gp-double} == 1">
            <f:then>
                <li class="xml-download has-multilinks">
                    <div class="multilinks">
                        <f:link.external uri="<dc:xpath xpath='(//mets:fileSec/mets:fileGrp[@USE=\"
                            FULLTEXT\"]//mets:file/mets:FLocat/@xlink:href)[{gp-page}]' />"
                        class="download-fulltext fulltext left"
                        target="_blank"
                        title="
                        <f:translate key='download.fulltext.leftPage' extensionName='slub_digitalcollections' />
                        ">
                        <f:translate key="download.fulltext.leftPage" extensionName="slub_digitalcollections" />
                        </f:link.external>
                        <f:link.external uri="<dc:xpath xpath='(//mets:fileSec/mets:fileGrp[@USE=\"
                            FULLTEXT\"]//mets:file/mets:FLocat/@xlink:href)[{gp-page2}]' />"
                        class="download-fulltext fulltext right"
                        target="_blank"
                        title="
                        <f:translate key='download.fulltext.rightPage' extensionName='slub_digitalcollections' />">
                        <f:translate key="download.fulltext.rightPage" extensionName="slub_digitalcollections" />
                        </f:link.external>
                    </div>
                </li>
            </f:then>
            <f:else>
                <li class="xml-download">
                    <f:link.external uri="<dc:xpath xpath='(//mets:fileSec/mets:fileGrp[@USE=\"
                        FULLTEXT\"]//mets:file/mets:FLocat/@xlink:href)[{gp-page}]' />"
                    class="download-fulltext ocr"
                    target="_blank"
                    title="
                    <f:translate key='download.fulltext.singlePage' extensionName='slub_digitalcollections' />">
                    <f:translate key="download.fulltext.singlePage" extensionName="slub_digitalcollections" />
                    </f:link.external>
                    <div style="display:none;">
                        <dc:extractFulltext file="{dc:xpath(xpath:'(//mets:fileSec/mets:fileGrp[@USE=\"
                            FULLTEXT\"]//mets:file/mets:FLocat/@xlink:href)[{gp-page}]')}" />
                    </div>
                </li>
                <f:comment><!-- [Fulltext downloads (TXT)] -------------------------- --></f:comment>
                <li class="txt-download">
                    <f:cObject typoscriptObjectPath="plugin.tx_dlf_fulltextdownloadtool" />
                </li>
            </f:else>
        </f:if>
        </f:if>

        <f:comment><!-- [METS downloads (XML)] -------------------------- --></f:comment>
        <f:if condition="<dc:xpath xpath='/mets:mets/mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:recordInfo/mods:recordIdentifier/@source' /> == 'http://digital.slub-dresden.de/oai/'">
            <f:comment>
                <!-- access via OAI does only work for slub-dresden.de -> access of the location field would be better -------------------------- -->
            </f:comment>
            <li class="mets-download">
                <f:link.external
                    uri="https://digital.slub-dresden.de/oai/?verb=GetRecord&metadataPrefix=mets&identifier=<dc:xpath xpath='(//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:recordInfo/mods:recordIdentifier)' />"
                    class="download-page mets" target="_blank"
                    title="<f:translate key='download.mets' extensionName='slub_digitalcollections' />">
                    <f:translate key="download.mets" extensionName="slub_digitalcollections" />
                </f:link.external>
            </li>
        </f:if>

        <f:comment><!-- [IIIF downloads (JSON)] -------------------------- --></f:comment>
        <f:if condition="{dc:xpath(xpath:'(/mets:mets/mets:fileSec/mets:fileGrp[@USE=\"
            DEFAULT\"]/mets:file/mets:FLocat/@xlink:href)[1]')}">
            <f:if condition="{dc:xpath(xpath: '//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:extension/slub:slub/slub:id[@type=\"digital\"]')}">
                <li class="iiif-download">
                    <f:link.external
                        uri="https://iiif.slub-dresden.de/iiif/2/{dc:xpath(xpath: '//mets:dmdSec/mets:mdWrap/mets:xmlData/mods:mods/mods:extension/slub:slub/slub:id[@type=\"
                        digital\"]')}/manifest.json" class="download-page iiif" target="_blank"
                        title="{f:translate(key: 'download.iiif', extensionName='slub_digitalcollections')}">
                        <f:translate key="download.iiif" extensionName="slub_digitalcollections" />
                    </f:link.external>
                </li>
            </f:if>
        </f:if>
    </ul>
    </li>

    <f:comment><!-- [douplepage switch (on/off)] -------------------------- --></f:comment>
    <li class="doublepage">
        <f:if condition="{gp-double} == 1">
            <f:then>
                <f:link.page pageUid="{kitodo.pageView}"
                    additionalParams="{tx_dlf:{page:'{gp-page}', double:'0', id:'{gp-id}', pagegrid:'0'}}"
                    class="tx-dlf-navigation-doubleOff"
                    title="<f:translate key='double.singlePageView'  extensionName='slub_digitalcollections' />">
                    <f:translate key="double.singlePageView" extensionName="slub_digitalcollections" />
                </f:link.page>
                <f:link.page pageUid="{kitodo.pageView}"
                    additionalParams="{tx_dlf:{page:'{dc:calc(val1:\'{gp-page}\', val2:\'1\', operator:\'+\')}', double:'1', id:'{gp-id}', pagegrid:'0'}}"
                    class="tx-dlf-navigation-doublePlusOne"
                    title="<f:translate key='double.RectoVerso' extensionName='slub_digitalcollections' />">
                    <span>
                        <f:translate key="double.RectoVerso" extensionName="slub_digitalcollections" />
                    </span>
                </f:link.page>
            </f:then>
            <f:else>
                <f:link.page pageUid="{kitodo.pageView}"
                    additionalParams="{tx_dlf:{page:'{gp-page}', double:'1', id:'{gp-id}', pagegrid:'0'}}"
                    class="tx-dlf-navigation-doubleOn"
                    title="<f:translate key='double.doublePageView'  extensionName='slub_digitalcollections' />">
                    <f:translate key="double.doublePageView" extensionName="slub_digitalcollections" />
                </f:link.page>
            </f:else>
        </f:if>
    </li>

    <f:comment><!-- [fulltext switch (on/off)] -------------------------- --></f:comment>
    <f:if condition="<dc:xpath xpath='(//mets:fileSec/mets:fileGrp[@USE=\"FULLTEXT\"]/mets:file[1]/mets:FLocat/@xlink:href)[1]' />">
    <li class="fulltext">
        <f:if condition="{gp-double} == 1">
            <f:then>
                <span class="select switchoff" id="tx-dlf-tools-fulltext"
                    title="<f:translate key='fulltext.no_fulltext_double' extensionName='slub_digitalcollections' />">
                    <f:translate key='fulltext.no_fulltext_double' extensionName='slub_digitalcollections' />
                </span>
            </f:then>
            <f:else>
                <f:if condition="{gp-pagegrid} == 1">
                    <f:then>
                        <span class="select switchoff" id="tx-dlf-tools-fulltext"
                            title="<f:translate key='fulltext.no_fulltext_gridpage' extensionName='slub_digitalcollections' />">
                            <f:translate key='fulltext.no_fulltext_gridpage' extensionName='slub_digitalcollections' />
                        </span>
                    </f:then>
                    <f:else>
                        <f:cObject typoscriptObjectPath="plugin.tx_dlf_fulltexttool" />
                    </f:else>
                </f:if>
            </f:else>
        </f:if>
    </li>
    </f:if>

    <f:comment><!-- [pagegrid switch (on/off)] -------------------------- --></f:comment>
    <li class="grid">
        <f:if condition="{mimeType}=='application/vnd.kitodo.iiif'">
            <f:then>
                <!-- not supported yet -> Kitodo.Presentation gridpager plugin does not know IIIF-Image API yet -->
                <span title="<f:translate key='gridpage.preview' extensionName='slub_digitalcollections' />">
                    <f:translate key='gridpage.preview' extensionName='slub_digitalcollections' />
                </span>
            </f:then>
            <f:else>
                <f:if condition="<dc:xpath xpath='(//mets:fileSec/mets:fileGrp[@USE=\"THUMBS\"]//mets:file/mets:FLocat/@xlink:href)[1]' />">
                <f:then>
                    <f:if condition="{gp-pagegrid} == 1">
                        <f:then>
                            <f:link.page pageUid="{kitodo.pageView}"
                                additionalParams="{tx_dlf:{page:'{gp-page}', double:'0', id:'{gp-id}', pagegrid:'0'}}"
                                class="active"
                                title="<f:translate key='double.singlePageView' extensionName='slub_digitalcollections' />">
                                <f:translate key='double.singlePageView' extensionName='slub_digitalcollections' />
                            </f:link.page>
                        </f:then>
                        <f:else>
                            <f:link.page id="digitalcollections-enable-grid-view" pageUid="{kitodo.pageView}" additionalParams="{tx_dlf:{page:'{gp-page}', double:'0', id:'{gp-id}', pagegrid:'1'}}" title="<f:translate key='gridpage.preview' extensionName='slub_digitalcollections' />"><f:translate key='gridpage.preview' extensionName='slub_digitalcollections' /></f:link.page>
                        </f:else>
                    </f:if>
                </f:then>
                <f:else>
                    <span title="<f:translate key='gridpage.preview' extensionName='slub_digitalcollections' />">
                        <f:translate key='gridpage.preview' extensionName='slub_digitalcollections' />
                    </span>
                </f:else>
        </f:if>
        </f:else>
        </f:if>
    </li>

    <f:comment><!-- [SRU Search] -------------------------- --></f:comment>
    <f:if condition="<dc:xpath xpath='//mets:amdSec/mets:digiprovMD/mets:mdWrap[@OTHERMDTYPE=\"DVLINKS\"]/mets:xmlData/dv:links/dv:sru' />">
    <f:then>
        <li class="submenu search">
            <a href="#" title="Search">Search</a>
        </li>
    </f:then>
    </f:if>
    </ul>
</div>

</html>